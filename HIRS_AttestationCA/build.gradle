plugins {
     id  'war'
     id  'java'
}

tasks.withType(JavaCompile) {
    options.release = 11
}

repositories {
    mavenCentral()
}

evaluationDependsOn(':HIRS_Utils')

dependencies {
//    implementation project(':TPM_Utils')
    implementation project(':HIRS_Structs')
    implementation project(':HIRS_Utils')
    implementation libs.bouncy.castle
    implementation libs.commons.codec
    implementation libs.commons.lang
    implementation libs.commons.io
    implementation libs.guava
    implementation libs.javax.jaxb
    implementation libs.spring.webmvc
    implementation libs.spring.data 
    implementation libs.spring.boot
    implementation libs.spring.retry
    implementation libs.spring.plugin
    implementation libs.log4j2
    implementation libs.log4j2.web
    implementation libs.protobuf.java

    implementation libs.servlet.api

    testImplementation project(':HIRS_Utils').sourceSets.test.output
    testImplementation project(':HIRS_Utils').sourceSets.test.resources

    testImplementation libs.commons.lang
    testImplementation libs.spring.test
    testImplementation libs.mockito
    testImplementation libs.testng
    testImplementation libs.hsqldb
}

task generateProtoBuf(type:Exec) {
    workingDir 'config'
    commandLine './genJavaProtoBuf.sh'
}

def copyVersion = project.task('copyVersion')
compileJava.dependsOn generateProtoBuf
copyVersion.dependsOn compileJava
war.dependsOn copyVersion

ext.configDir = new File(projectDir, 'config')
ext.checkstyleConfigDir = "$configDir/checkstyle"

war {
    from(buildDir) {
        include 'VERSION'
        into 'WEB-INF/classes'
    }
    archiveFileName = 'HIRS_AttestationCA.war'
}
